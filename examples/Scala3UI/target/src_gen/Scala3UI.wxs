<?xml version='1.0' encoding='windows-1252'?>
<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>
  <?include Includes.wxi ?>
  <Product Id='e297d456-ea7b-4560-ad66-4f7ef4c0e6b9'
      UpgradeCode='f1efc82a-61fa-4ee9-bcde-f856229dabd1' Name='$(var.ProductName)'
      Version='$(var.ProductVersion).0' Manufacturer='$(var.Manufacturer)'
      Language='$(var.LocaleID)' Codepage='1252'>

    <Package Id='*'
        Keywords='$(var.Keywords)' Description="$(var.ProductName) Installer"
        Comments='The Scala Programming Language' Manufacturer='$(var.Manufacturer)'
        InstallerVersion='200' InstallScope="perMachine"
        Languages='$(var.LocaleID)' Compressed='yes' SummaryCodepage='1252' />

    <Media Id='1' Cabinet='Scala3.cab' EmbedCab='yes' />

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='ProgramFilesFolder' Name='PFiles'>
          <!-- fragments.wxs -->
      </Directory>
      <!-- Step 1: Define the directory structure -->
      <Directory Id="ProgramMenuFolder" Name="Programs">
         <Directory Id="ApplicationProgramsFolder" Name="$(var.ProductName)" />
      </Directory>
      <Directory Id="DesktopFolder" Name="Desktop" />
    </Directory>

    <SetProperty Id="APIURL"
        Value="https://scala-lang.org/api/3.x/"
        Sequence="execute"
        Before="CreateShortcuts" />
    <SetProperty Id="LicenseURL"
        Value="https://www.scala-lang.org/license/"
        Sequence="execute"
        Before="CreateShortcuts" />

    <!-- Step 2: Add the shortcut(s) to our installer package -->
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcuts" Guid="6c76f81a-3278-4f4b-9f98-8e5247ffa789">
        <Shortcut Id="ScalaREPL" 
            Name="$(var.ProductName) REPL" 
            Description="$(var.ProductName) Interactive Shell"
            Target="[SystemFolder]cmd.exe"
            Arguments='/k "call ^"[#repl_bat]^""'
            WorkingDirectory="PersonalFolder">
          <Icon Id="ScalaREPLIcon" SourceFile="!(bindpath.rsrc)\favicon.ico" />
        </Shortcut>
        <Shortcut Id="APIShortcut"
            Name="API Documentation"
            Description="$(var.ProductName) API Documentation"
            Target="[APIURL]">
          <Icon Id="APIIcon" SourceFile="!(bindpath.rsrc)\network.ico" />
        </Shortcut>
        <Shortcut Id="LicenseShortcut"
            Name="License"
            Description="$(var.ProductName) License"
            Target="[LicenseURL]">
          <Icon Id="LicenseIcon" SourceFile="!(bindpath.rsrc)\network.ico" />
        </Shortcut>
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
        <RegistryValue Root="HKCU" Key="Software\$(var.CompanyName)\[ProductName]" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
        <Shortcut Id="UninstallProduct"             
            Name="Uninstall $(var.ProductName)"
            Description="Uninstalls $(var.ProductName)"
            Target="[SystemFolder]msiexec.exe"
            Arguments="/x [ProductCode]" />
      </Component>
	</DirectoryRef>

	<DirectoryRef Id='ProgramFilesFolder'>
      <Component Id="ApplicationEnvironment" Guid="81bcce4d-9c5d-46e7-8032-ca2742e00230" KeyPath="yes">
        <!-- https://www.firegiant.com/wix/tutorial/com-expression-syntax-miscellanea/environmentally-friendly/ -->
        <Environment Id="UpdatePath"
            Name="PATH" Value="[bin]" 
            Action="set" Permanent="no" System="yes" Part="last" Separator=";" />
	  </Component>
    </DirectoryRef>

    <Feature Id='Complete' Title="$(var.ProductName)" Level='1'>
      <ComponentGroupRef Id='PackFiles' />
      <!-- Step 3: Tell WiX to install the shortcut(s) -->
      <ComponentRef Id="ApplicationShortcuts" />
      <ComponentRef Id="ApplicationEnvironment" />
    </Feature>

    <Icon Id="Favicon" SourceFile="!(bindpath.rsrc)\favicon.ico" />
    <Property Id="ARPPRODUCTICON" Value="Favicon" />

    <WixVariable Id="WixUILicenseRtf" Value="!(bindpath.rsrc)\LICENSE.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="!(bindpath.rsrc)\BannerTop.bmp" />  <!-- 493 x 58 -->
    <WixVariable Id="WixUIDialogBmp" Value="!(bindpath.rsrc)\Dialog.bmp" />  <!-- 493 x 312 -->
    <!--
	<WixVariable Id="WixUIExclamationIco" Value="resources\exclamation.ico" />  32 ?? 32
    <WixVariable Id="WixUIInfoIco" Value="!(bindpath.rsrc)\favicon.ico" />  32 ?? 32
    <WixVariable Id="WixUINewIco" Value="!(bindpath.rsrc)\favicon.ico" />  16 x 16
    <WixVariable Id="WixUIUpIco" Value="!(bindpath.rsrc)\favicon.ico" />  16 x 16
	-->
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <UIRef Id="WixUI_InstallDir" />
  </Product>
</Wix>
